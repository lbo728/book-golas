# Push Admin 사용 가이드

북골라스 푸시 알림 관리를 위한 어드민 대시보드 사용 가이드입니다.

## 접속 정보

| 환경 | URL |
|------|-----|
| Production | https://web-34e49pjk5-lbo728s-projects.vercel.app/admin |
| Local | http://localhost:3000/admin |

---

## 1. 대시보드 (`/admin`)

메인 대시보드에서 푸시 알림의 전체 현황을 한눈에 파악할 수 있습니다.

### 주요 지표

| 지표 | 설명 |
|------|------|
| **오늘 발송** | 오늘 발송된 총 푸시 알림 수 |
| **오늘 CTR** | 오늘 발송된 푸시의 클릭률 (클릭 수 / 발송 수 × 100) |
| **활성 사용자** | 알림을 받은 고유 사용자 수 |

### 타입별 분포

푸시 타입별 발송 현황을 확인할 수 있습니다:

| 타입 | 트리거 조건 | 목적 |
|------|------------|------|
| `inactive` | 3일 이상 독서 미활동 | 재참여 유도 |
| `deadline` | 목표일까지 3일 이내 | 목표 달성 독려 |
| `progress` | 진행률 80% 이상 | 완독 격려 |
| `streak` | 연속 독서일 1~6일 | 연속일 유지 동기부여 |
| `achievement` | 책 완독 시 | 성취 축하 |

### 최근 로그

가장 최근 발송된 5개의 푸시 알림을 확인할 수 있습니다.

---

## 2. 템플릿 관리 (`/admin/push-templates`)

코드 배포 없이 푸시 메시지를 수정할 수 있습니다.

### 템플릿 목록

| 컬럼 | 설명 |
|------|------|
| Type | 푸시 타입 (inactive, deadline, progress, streak, achievement) |
| Title | 푸시 알림 제목 |
| Body Template | 푸시 본문 템플릿 (변수 포함 가능) |
| Priority | 우선순위 (낮을수록 높은 우선순위) |
| Active | 활성화 상태 |
| Actions | 수정 버튼 |

### 템플릿 변수

본문에서 사용 가능한 변수:

| 변수 | 설명 | 사용 예시 |
|------|------|----------|
| `{days}` | 일수 (비활동일, 남은일, 연속일) | `{days}일째 독서를 안 했네요` |
| `{bookTitle}` | 책 제목 | `"{bookTitle}" 완독까지` |
| `{percent}` | 진행률 (%) | `{percent}% 완독했습니다` |

### 템플릿 수정하기

1. 수정하려는 템플릿 행의 **Edit** 버튼 클릭
2. 다이얼로그에서 Title, Body Template 수정
3. **Save Changes** 클릭

### 활성화/비활성화

- **Active** 토글을 클릭하여 즉시 활성화/비활성화
- 비활성화된 템플릿은 푸시 발송 시 사용되지 않음
- 비활성화 시 해당 타입의 푸시는 기본 메시지로 발송됨

### 기본 템플릿 예시

```
Type: inactive
Title: 독서를 잊지 마세요! 📚
Body: {days}일째 독서를 안 했네요. 다시 시작해볼까요?
```

```
Type: deadline
Title: 목표 완료까지 얼마 안 남았어요! ⏰
Body: "{bookTitle}" 완독까지 {days}일 남았습니다.
```

```
Type: progress
Title: 목표 달성까지 조금만 더! 🎯
Body: "{bookTitle}" {percent}% 완독했습니다. 조금만 더 화이팅!
```

```
Type: streak
Title: 독서 연속일을 이어가세요! 🔥
Body: 독서 연속일이 {days}일입니다! 오늘도 읽어볼까요?
```

```
Type: achievement
Title: 목표를 달성했어요! 🎉
Body: "{bookTitle}" 완독을 축하합니다!
```

---

## 3. 로그 조회 (`/admin/push-logs`)

발송된 푸시 알림의 상세 이력을 확인할 수 있습니다.

### 로그 목록

| 컬럼 | 설명 |
|------|------|
| Type | 푸시 타입 (badge로 표시) |
| Title | 발송된 푸시 제목 |
| Body | 발송된 푸시 본문 |
| Sent At | 발송 시간 |
| Clicked | 클릭 여부 (체크마크 표시) |

### 필터링

1. **Push Type** 드롭다운에서 특정 타입 선택
2. 선택 시 해당 타입의 로그만 표시
3. "All Types" 선택 시 전체 로그 표시

### 페이지네이션

- 한 페이지당 20개 로그 표시
- **Previous** / **Next** 버튼으로 페이지 이동

---

## 4. 운영 가이드

### 일일 모니터링 체크리스트

1. **대시보드 확인**
   - 오늘 발송 수가 예상 범위인지 확인
   - CTR이 정상 범위(5~15%)인지 확인

2. **로그 확인**
   - 에러 없이 정상 발송되었는지 확인
   - 특정 타입에 발송이 집중되지 않았는지 확인

### CTR 개선 팁

| 상황 | 권장 조치 |
|------|----------|
| CTR < 5% | 메시지 문구 개선, 이모지 추가 |
| 특정 타입 CTR 낮음 | 해당 템플릿 A/B 테스트 |
| 전체 CTR 하락 | 발송 시간대 조정 검토 |

### 템플릿 변경 시 주의사항

1. **변수명 정확히 입력**: `{days}`, `{bookTitle}`, `{percent}` 오타 주의
2. **길이 제한**: 제목 50자, 본문 100자 이내 권장
3. **테스트**: 변경 후 다음 발송 시간에 정상 동작 확인

---

## 5. 기술 정보

### 푸시 발송 스케줄

- **트리거**: GitHub Actions (매 시간 정각)
- **대상**: `fcm_tokens.preferred_hour`와 현재 KST 시간이 일치하는 사용자
- **Edge Function**: `send-batch-nudge`

### 클릭 추적

- **트리거**: 앱에서 푸시 탭 시
- **Edge Function**: `log-push-click`
- **업데이트 필드**: `is_clicked`, `clicked_at`

### 데이터베이스 테이블

| 테이블 | 용도 |
|--------|------|
| `push_templates` | 푸시 메시지 템플릿 저장 |
| `push_logs` | 발송/클릭 이력 저장 |
| `push_stats_daily` | 일별 통계 뷰 (자동 집계) |

---

## 6. 문제 해결

### Q: 푸시가 발송되지 않아요

1. `push_templates`에서 해당 타입이 활성화되어 있는지 확인
2. GitHub Actions 워크플로우 실행 로그 확인
3. Supabase Edge Function 로그 확인

### Q: CTR이 0%로 표시돼요

1. 앱에서 `log-push-click` API 호출이 정상인지 확인
2. `push_logs` 테이블에서 `is_clicked` 값 직접 확인

### Q: 템플릿 수정이 반영되지 않아요

1. 브라우저 새로고침 후 재확인
2. `push_templates` 테이블에서 직접 값 확인
3. Edge Function은 템플릿을 캐싱하므로, 새 발송 시점에 반영됨

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2024-12-25 | 1.0 | 최초 작성 |
